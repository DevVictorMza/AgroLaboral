<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Filtros de Ofertas - AgroLaboral</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .test-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .test-result {
            padding: 0.5rem;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .test-success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #28a745;
        }
        .test-error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
        }
        .test-info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid #17a2b8;
            color: #17a2b8;
        }
        .loading {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">
            <i class="fas fa-vial me-2"></i>
            Test Filtros de Ofertas de Empleo
        </h1>

        <!-- Test 1: Construcción de URLs -->
        <div class="test-section">
            <h3><i class="fas fa-link me-2"></i>Test 1: Construcción de URLs</h3>
            <p class="text-muted">Verificando que las URLs se construyan correctamente con query parameters</p>
            <button class="btn btn-primary" onclick="testConstruccionURLs()">
                <i class="fas fa-play me-2"></i>Ejecutar Test
            </button>
            <div id="test1-results"></div>
        </div>

        <!-- Test 2: API Endpoints -->
        <div class="test-section">
            <h3><i class="fas fa-server me-2"></i>Test 2: Endpoints de API</h3>
            <p class="text-muted">Probando las respuestas del backend mock para diferentes filtros</p>
            <button class="btn btn-success" onclick="testEndpointsAPI()">
                <i class="fas fa-play me-2"></i>Ejecutar Test
            </button>
            <div id="test2-results"></div>
        </div>

        <!-- Test 3: Funciones JavaScript -->
        <div class="test-section">
            <h3><i class="fas fa-code me-2"></i>Test 3: Funciones de Filtrado</h3>
            <p class="text-muted">Verificando el comportamiento de las funciones de filtrado</p>
            <button class="btn btn-warning" onclick="testFuncionesFiltrado()">
                <i class="fas fa-play me-2"></i>Ejecutar Test
            </button>
            <div id="test3-results"></div>
        </div>

        <!-- Test 4: Integración Completa -->
        <div class="test-section">
            <h3><i class="fas fa-cogs me-2"></i>Test 4: Integración Completa</h3>
            <p class="text-muted">Simulando flujo completo de usuario</p>
            <button class="btn btn-info" onclick="testIntegracionCompleta()">
                <i class="fas fa-play me-2"></i>Ejecutar Test
            </button>
            <div id="test4-results"></div>
        </div>

        <!-- Resultados Generales -->
        <div class="test-section">
            <h3><i class="fas fa-chart-pie me-2"></i>Resumen de Tests</h3>
            <div id="resumen-tests">
                <p class="text-muted">Ejecuta los tests para ver el resumen</p>
            </div>
        </div>
    </div>

    <!-- Configuración Mock para Tests -->
    <script>
        // Configuración para tests
        const TEST_CONFIG = {
            BASE_URL: 'http://localhost:8080',
            ENDPOINTS: {
                OFERTAS: '/privado/ofertas-empleo'
            }
        };

        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };

        function logTest(testName, success, message, container) {
            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }

            const resultClass = success ? 'test-success' : 'test-error';
            const icon = success ? 'fas fa-check' : 'fas fa-times';
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${resultClass}`;
            resultDiv.innerHTML = `
                <i class="${icon} me-2"></i>
                <strong>${testName}:</strong> ${message}
            `;
            
            container.appendChild(resultDiv);
            updateResumen();
        }

        function updateResumen() {
            const resumenDiv = document.getElementById('resumen-tests');
            const successRate = testResults.total > 0 ? (testResults.passed / testResults.total * 100).toFixed(1) : 0;
            
            resumenDiv.innerHTML = `
                <div class="row text-center">
                    <div class="col-md-3">
                        <h4 class="text-success">${testResults.passed}</h4>
                        <small>Tests Exitosos</small>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-danger">${testResults.failed}</h4>
                        <small>Tests Fallidos</small>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-info">${testResults.total}</h4>
                        <small>Total Tests</small>
                    </div>
                    <div class="col-md-3">
                        <h4 class="text-warning">${successRate}%</h4>
                        <small>Tasa de Éxito</small>
                    </div>
                </div>
            `;
        }

        // Test 1: Construcción de URLs
        function testConstruccionURLs() {
            const container = document.getElementById('test1-results');
            container.innerHTML = '<div class="test-info"><i class="fas fa-spinner loading me-2"></i>Ejecutando tests de construcción de URLs...</div>';
            
            setTimeout(() => {
                container.innerHTML = '';

                // Test URL base
                const urlBase = `${TEST_CONFIG.BASE_URL}${TEST_CONFIG.ENDPOINTS.OFERTAS}`;
                logTest('URL Base', 
                       urlBase === 'http://localhost:8081/privado/ofertas-empleo',
                       `URL base: ${urlBase}`, 
                       container);

                // Test URL con parámetro vigente=true
                const urlVigentes = `${urlBase}?vigente=true`;
                logTest('URL Vigentes', 
                       urlVigentes.includes('vigente=true'),
                       `URL vigentes: ${urlVigentes}`, 
                       container);

                // Test URL con parámetro vigente=false
                const urlCerradas = `${urlBase}?vigente=false`;
                logTest('URL Cerradas', 
                       urlCerradas.includes('vigente=false'),
                       `URL cerradas: ${urlCerradas}`, 
                       container);

                // Test parámetros múltiples (simulación)
                const urlMultiple = `${urlBase}?vigente=true&page=1`;
                logTest('Parámetros Múltiples', 
                       urlMultiple.includes('vigente=true') && urlMultiple.includes('page=1'),
                       `URL múltiple: ${urlMultiple}`, 
                       container);
            }, 1000);
        }

        // Test 2: Endpoints de API
        async function testEndpointsAPI() {
            const container = document.getElementById('test2-results');
            container.innerHTML = '<div class="test-info"><i class="fas fa-spinner loading me-2"></i>Probando endpoints de API...</div>';

            // Esperar un poco para simular carga
            await new Promise(resolve => setTimeout(resolve, 500));
            container.innerHTML = '';

            try {
                // Test endpoint todas las ofertas
                const responseAll = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo`);
                const dataAll = await responseAll.json();
                logTest('Endpoint Todas', 
                       Array.isArray(dataAll) && dataAll.length > 0,
                       `Recibidas ${dataAll.length} ofertas totales`, 
                       container);

                // Test endpoint ofertas vigentes
                const responseVigentes = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo?vigente=true`);
                const dataVigentes = await responseVigentes.json();
                const todasVigentes = dataVigentes.every(oferta => oferta.vigente === true);
                logTest('Endpoint Vigentes', 
                       Array.isArray(dataVigentes) && todasVigentes,
                       `Recibidas ${dataVigentes.length} ofertas vigentes`, 
                       container);

                // Test endpoint ofertas cerradas
                const responseCerradas = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo?vigente=false`);
                const dataCerradas = await responseCerradas.json();
                const todasCerradas = dataCerradas.every(oferta => oferta.vigente === false);
                logTest('Endpoint Cerradas', 
                       Array.isArray(dataCerradas) && todasCerradas,
                       `Recibidas ${dataCerradas.length} ofertas cerradas`, 
                       container);

                // Test coherencia de datos
                const totalCalculado = dataVigentes.length + dataCerradas.length;
                logTest('Coherencia de Datos', 
                       totalCalculado === dataAll.length,
                       `Total: ${dataAll.length}, Vigentes: ${dataVigentes.length}, Cerradas: ${dataCerradas.length}`, 
                       container);

            } catch (error) {
                logTest('Error de Conexión', 
                       false,
                       `Error: ${error.message}`, 
                       container);
            }
        }

        // Test 3: Funciones de Filtrado
        function testFuncionesFiltrado() {
            const container = document.getElementById('test3-results');
            container.innerHTML = '<div class="test-info"><i class="fas fa-spinner loading me-2"></i>Probando funciones de filtrado...</div>';
            
            setTimeout(() => {
                container.innerHTML = '';

                // Test estado inicial
                logTest('Estado Inicial', 
                       typeof window.estadoFiltroOfertas === 'undefined' || window.estadoFiltroOfertas.actual === null,
                       'Estado inicial correcto', 
                       container);

                // Test función de descripción de filtro (si existe)
                try {
                    const descripcion = 'todas las ofertas'; // valor esperado por defecto
                    logTest('Descripción de Filtro', 
                           descripcion.includes('todas'),
                           `Descripción: "${descripcion}"`, 
                           container);
                } catch (error) {
                    logTest('Descripción de Filtro', 
                           false,
                           `Error: ${error.message}`, 
                           container);
                }

                // Test validación de parámetros
                const parametrosValidos = [null, true, false];
                parametrosValidos.forEach((param, index) => {
                    const esValido = param === null || typeof param === 'boolean';
                    logTest(`Parámetro ${index + 1}`, 
                           esValido,
                           `Parámetro ${param} es válido: ${esValido}`, 
                           container);
                });

                // Test construcción de query string
                const queryVigente = 'vigente=true';
                const queryCerrada = 'vigente=false';
                logTest('Query String Vigente', 
                       queryVigente === 'vigente=true',
                       `Query: ${queryVigente}`, 
                       container);
                logTest('Query String Cerrada', 
                       queryCerrada === 'vigente=false',
                       `Query: ${queryCerrada}`, 
                       container);
            }, 1000);
        }

        // Test 4: Integración Completa
        async function testIntegracionCompleta() {
            const container = document.getElementById('test4-results');
            container.innerHTML = '<div class="test-info"><i class="fas fa-spinner loading me-2"></i>Ejecutando test de integración completa...</div>';

            await new Promise(resolve => setTimeout(resolve, 500));
            container.innerHTML = '';

            try {
                // Simulación de flujo completo
                logTest('Inicio de Sesión Mock', 
                       true,
                       'Simulación de inicio de sesión exitosa', 
                       container);

                // Test carga inicial
                const responseInicial = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo`);
                const dataInicial = await responseInicial.json();
                logTest('Carga Inicial', 
                       responseInicial.ok && Array.isArray(dataInicial),
                       `Carga inicial exitosa: ${dataInicial.length} ofertas`, 
                       container);

                // Test cambio a filtro vigentes
                const responseVigentes = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo?vigente=true`);
                const dataVigentes = await responseVigentes.json();
                logTest('Filtro Vigentes', 
                       responseVigentes.ok && dataVigentes.length !== dataInicial.length,
                       `Filtro aplicado: ${dataVigentes.length} ofertas vigentes`, 
                       container);

                // Test cambio a filtro cerradas
                const responseCerradas = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo?vigente=false`);
                const dataCerradas = await responseCerradas.json();
                logTest('Filtro Cerradas', 
                       responseCerradas.ok && dataCerradas.length !== dataInicial.length,
                       `Filtro aplicado: ${dataCerradas.length} ofertas cerradas`, 
                       container);

                // Test regreso a todas
                const responseTodas = await fetch(`${TEST_CONFIG.BASE_URL}/privado/ofertas-empleo`);
                const dataTodas = await responseTodas.json();
                logTest('Regreso a Todas', 
                       responseTodas.ok && dataTodas.length === dataInicial.length,
                       `Regreso exitoso: ${dataTodas.length} ofertas totales`, 
                       container);

                // Test consistencia de datos
                const sumaFiltros = dataVigentes.length + dataCerradas.length;
                logTest('Consistencia Final', 
                       sumaFiltros === dataTodas.length,
                       `Consistencia verificada: ${sumaFiltros} = ${dataTodas.length}`, 
                       container);

            } catch (error) {
                logTest('Error de Integración', 
                       false,
                       `Error: ${error.message}`, 
                       container);
            }
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🧪 Test de Filtros de Ofertas iniciado');
            updateResumen();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>