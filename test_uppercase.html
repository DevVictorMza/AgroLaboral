<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Conversi칩n a May칰sculas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body style="padding: 2rem;">
    <div class="container">
        <h2 class="text-center mb-4">Prueba de Conversi칩n Autom치tica a May칰sculas</h2>
        
        <div class="card" style="background: var(--card-bg); border: 1px solid #444;">
            <div class="card-body">
                <h5 class="mb-3">Campos con Conversi칩n Autom치tica</h5>
                
                <!-- Campo Nombre Establecimiento -->
                <div class="mb-3" style="position: relative;">
                    <label for="nombreEstablecimiento" class="form-label">
                        Nombre del Establecimiento 
                        <small class="text-muted">(se convierte autom치ticamente a may칰sculas)</small>
                    </label>
                    <input type="text" 
                           class="form-control" 
                           id="nombreEstablecimiento" 
                           name="nombreEstablecimiento" 
                           placeholder="Ejemplo: Finca Los Olivos"
                           autocomplete="organization">
                    <div class="char-counter">0/50</div>
                </div>
                
                <!-- Campo Calle -->
                <div class="mb-3" style="position: relative;">
                    <label for="calle" class="form-label">
                        Calle 
                        <small class="text-muted">(m치ximo 25 caracteres - se convierte a may칰sculas)</small>
                    </label>
                    <input type="text" 
                           class="form-control" 
                           id="calle" 
                           name="calle" 
                           placeholder="Ejemplo: RUTA 50" 
                           maxlength="25"
                           autocomplete="street-address">
                    <div class="char-counter">0/25</div>
                </div>
                
                <!-- Campo Normal para Comparaci칩n -->
                <div class="mb-3">
                    <label for="campoNormal" class="form-label">
                        Campo Normal (sin conversi칩n)
                    </label>
                    <input type="text" 
                           class="form-control" 
                           id="campoNormal" 
                           name="campoNormal" 
                           placeholder="Este texto se mantiene como lo escribas">
                </div>
                
                <div class="alert alert-info mt-4">
                    <h6>Instrucciones de Prueba:</h6>
                    <ol>
                        <li><strong>Escriba en min칰sculas</strong> en los campos "Nombre del Establecimiento" y "Calle" (SIN activar May칰s)</li>
                        <li>Observe c칩mo el texto aparece inmediatamente en may칰sculas mientras escribe</li>
                        <li>Pruebe escribir "finca los olivos" - debe aparecer como "FINCA LOS OLIVOS"</li>
                        <li>Pruebe copiando y pegando texto en min칰sculas - debe convertirse autom치ticamente</li>
                        <li>Compare con el "Campo Normal" que mantiene el texto como lo escriba</li>
                        <li>Note el icono 游댟 que indica campos con conversi칩n autom치tica</li>
                    </ol>
                    <div class="alert alert-warning mt-2">
                        <strong>Importante:</strong> Escriba normalmente en min칰sculas. El sistema debe mostrar todo en may칰sculas autom치ticamente.
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Incluir las funciones necesarias para la prueba
        
        // Funci칩n gen칠rica para agregar contador de caracteres
        function addCharacterCounter(inputId, maxLength, options = {}) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const config = {
                warningThreshold: options.warningThreshold || Math.floor(maxLength * 0.8),
                dangerThreshold: options.dangerThreshold || Math.floor(maxLength * 0.92),
                allowOnlyNumbers: options.allowOnlyNumbers || false,
                allowUppercase: options.allowUppercase || false,
                customRegex: options.customRegex || null,
                ...options
            };
            
            // Crear contenedor para el contador si no existe
            if (!input.parentNode.querySelector('.char-counter')) {
                const counter = document.createElement('div');
                counter.className = 'char-counter';
                counter.textContent = `0/${maxLength}`;
                input.parentNode.style.position = 'relative';
                input.parentNode.appendChild(counter);
            }
            
            const counter = input.parentNode.querySelector('.char-counter');
            
            function updateCounter() {
                const currentLength = input.value.length;
                counter.textContent = `${currentLength}/${maxLength}`;
                
                // Cambiar color seg칰n el umbral
                counter.classList.remove('warning', 'danger');
                if (currentLength >= config.dangerThreshold) {
                    counter.classList.add('danger');
                } else if (currentLength >= config.warningThreshold) {
                    counter.classList.add('warning');
                }
            }
            
            input.addEventListener('input', updateCounter);
            input.addEventListener('keyup', updateCounter);
            input.addEventListener('paste', () => setTimeout(updateCounter, 10));
        }
        
        // Funci칩n para convertir autom치ticamente texto a may칰sculas
        function addUppercaseConverter(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            // Funci칩n principal para convertir a may칰sculas
            function forceUppercase(e) {
                // Guardar posici칩n del cursor
                const cursorStart = input.selectionStart;
                const cursorEnd = input.selectionEnd;
                const scrollTop = input.scrollTop;
                
                // Obtener valor actual
                const currentValue = input.value;
                const upperValue = currentValue.toUpperCase();
                
                // Siempre convertir a may칰sculas, sin importar el estado previo
                if (currentValue !== upperValue) {
                    // Aplicar conversi칩n
                    input.value = upperValue;
                    
                    // Restaurar cursor y scroll
                    input.setSelectionRange(cursorStart, cursorEnd);
                    input.scrollTop = scrollTop;
                    
                    // Feedback visual
                    input.classList.add('uppercase-converting');
                    setTimeout(() => {
                        input.classList.remove('uppercase-converting');
                    }, 120);
                }
            }
            
            // Manejador para eventos de entrada de texto
            function handleRealTimeInput(e) {
                // Usar setTimeout para asegurar que el valor se ha actualizado
                setTimeout(() => {
                    forceUppercase(e);
                }, 0);
            }
            
            // Manejador para pegado de texto
            function handlePaste(e) {
                // Delay m치s largo para pegado
                setTimeout(() => {
                    forceUppercase(e);
                    // Feedback visual m치s notable para paste
                    input.classList.add('uppercase-converting');
                    setTimeout(() => {
                        input.classList.remove('uppercase-converting');
                    }, 250);
                }, 5);
            }
            
            // Agregar event listeners
            input.addEventListener('input', handleRealTimeInput);
            input.addEventListener('paste', handlePaste);
            input.addEventListener('keyup', forceUppercase);
            
            // Convertir valor inicial si existe
            if (input.value && input.value.trim() !== '') {
                input.value = input.value.toUpperCase();
            }
            
            // Configurar atributos del input
            input.setAttribute('data-uppercase', 'true');
            input.setAttribute('autocapitalize', 'characters');
            input.style.textTransform = 'uppercase';
        }
        
        // Inicializar cuando el DOM est칠 listo
        document.addEventListener('DOMContentLoaded', function() {
            // Agregar contadores de caracteres
            addCharacterCounter('nombreEstablecimiento', 50);
            addCharacterCounter('calle', 25);
            
            // Agregar conversi칩n autom치tica a may칰sculas
            addUppercaseConverter('nombreEstablecimiento');
            addUppercaseConverter('calle');
            
            console.log('Funcionalidad de conversi칩n a may칰sculas inicializada correctamente');
        });
    </script>
</body>
</html>