<!-- 
INSTRUCCIONES PARA DIAGN√ìSTICO DE GEOLOCALIZACI√ìN:

1. Abre el navegador en http://localhost:3000
2. Presiona F12 para abrir las DevTools
3. Ve a la pesta√±a "Console" 
4. Busca estos mensajes:
   - "üó∫Ô∏è === INICIALIZANDO MAPA PRINCIPAL ==="
   - "üìç === AGREGANDO CONTROL DE GEOLOCALIZACI√ìN ==="
   - "‚úÖ Control de geolocalizaci√≥n agregado exitosamente"

5. Navega hasta el mapa principal (scroll hacia abajo)
6. Busca un bot√≥n con icono de flecha (üìç) en la esquina superior derecha del mapa
7. Haz clic en el bot√≥n
8. En la consola deber√≠as ver: "üñ±Ô∏è Clic en bot√≥n de geolocalizaci√≥n"
9. Permite acceso a la ubicaci√≥n cuando lo solicite el navegador
10. Deber√≠as ver: "‚úÖ Ubicaci√≥n obtenida" y "üìç Marcador agregado al mapa"

SOLUCI√ìN R√ÅPIDA:
Si no ves el bot√≥n o no funciona, puedes probar este c√≥digo en la consola:

// Verificar si el mapa est√° inicializado
console.log('Mapa principal:', mapaPrincipal);

// Probar geolocalizaci√≥n directamente
navigator.geolocation.getCurrentPosition(
  function(pos) {
    console.log('Ubicaci√≥n:', pos.coords.latitude, pos.coords.longitude);
    
    // Crear marcador rojo manualmente
    if (mapaPrincipal.instancia) {
      const redMarker = L.marker([pos.coords.latitude, pos.coords.longitude], {
        icon: L.divIcon({
          html: '<div style="background: red; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px red;"></div>',
          iconSize: [26, 26],
          iconAnchor: [13, 13]
        })
      }).addTo(mapaPrincipal.instancia);
      
      mapaPrincipal.instancia.flyTo([pos.coords.latitude, pos.coords.longitude], 15);
      console.log('Marcador rojo creado manualmente');
    }
  },
  function(err) { console.error('Error:', err); }
);

PROBLEMAS COMUNES:
- Si no aparece el bot√≥n: El mapa no se inicializ√≥ correctamente
- Si no funciona la geolocalizaci√≥n: Problemas de permisos del navegador
- Si no se ve el marcador rojo: Problema con los estilos CSS

ARCHIVOS INVOLUCRADOS:
- js/app.js: Funciones de geolocalizaci√≥n (l√≠nea ~4250-4400)
- css/map-markers.css: Estilos del marcador rojo
- index.html: Referencia al CSS y mapa principal (#main-map)
-->

<style>
.debug-geolocacion {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 10000;
    background: #dc3545;
    color: white;
    padding: 10px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.debug-geolocacion:hover {
    background: #c82333;
}
</style>

<button class="debug-geolocacion" onclick="testGeolocalizacion()">
    üìç Test Geo
</button>

<script>
function testGeolocalizacion() {
    console.log('üîç === TEST MANUAL DE GEOLOCALIZACI√ìN ===');
    
    // Verificar estado del sistema
    console.log('MapaPrincipal existe:', typeof mapaPrincipal !== 'undefined');
    console.log('MapaPrincipal.instancia:', mapaPrincipal ? mapaPrincipal.instancia : 'No existe');
    console.log('Geolocalizaci√≥n soportada:', 'geolocation' in navigator);
    
    if (typeof mapaPrincipal === 'undefined' || !mapaPrincipal.instancia) {
        alert('‚ùå El mapa principal no est√° inicializado. Revisa la consola para errores.');
        return;
    }
    
    if (!navigator.geolocation) {
        alert('‚ùå Tu navegador no soporta geolocalizaci√≥n.');
        return;
    }
    
    console.log('üåç Solicitando ubicaci√≥n...');
    
    navigator.geolocation.getCurrentPosition(
        function(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            console.log('‚úÖ Ubicaci√≥n obtenida:', lat, lng);
            
            // Crear marcador rojo de prueba
            const testMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    html: '<div style="background: #ff0000; width: 24px; height: 24px; border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 2px #ff0000, 0 0 15px rgba(255,0,0,0.8); animation: pulse 2s infinite;"></div><style>@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }</style>',
                    iconSize: [32, 32],
                    iconAnchor: [16, 16]
                }),
                zIndexOffset: 2000
            }).addTo(mapaPrincipal.instancia);
            
            testMarker.bindPopup(`
                <div style="text-align: center;">
                    <h6 style="color: red;">üéØ TEST - Tu Ubicaci√≥n</h6>
                    <p><strong>Lat:</strong> ${lat.toFixed(6)}</p>
                    <p><strong>Lng:</strong> ${lng.toFixed(6)}</p>
                    <p><strong>Precisi√≥n:</strong> ¬±${Math.round(position.coords.accuracy)}m</p>
                </div>
            `).openPopup();
            
            // Centrar mapa
            mapaPrincipal.instancia.flyTo([lat, lng], 16);
            
            console.log('‚úÖ Marcador de prueba creado y mostrado');
            alert('‚úÖ ¬°Ubicaci√≥n encontrada! Marcador rojo visible en el mapa.');
        },
        function(error) {
            console.error('‚ùå Error de geolocalizaci√≥n:', error);
            
            let mensaje = 'Error desconocido';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    mensaje = 'Permisos denegados. Ve a configuraci√≥n del navegador y permite ubicaci√≥n para este sitio.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    mensaje = 'Ubicaci√≥n no disponible. Verifica que el GPS est√© activado.';
                    break;
                case error.TIMEOUT:
                    mensaje = 'Tiempo agotado. Intenta nuevamente.';
                    break;
            }
            
            alert('‚ùå ' + mensaje);
        },
        {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 60000
        }
    );
}

// Auto-test al cargar (opcional)
// setTimeout(testGeolocalizacion, 2000);
</script>